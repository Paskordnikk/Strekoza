<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet, noimageindex, nocache">
    <meta name="googlebot" content="noindex, nofollow, noarchive, nosnippet, noimageindex">
    <meta name="bingbot" content="noindex, nofollow, noarchive, nosnippet, noimageindex">
    <meta name="yandex" content="noindex, nofollow, noarchive">
    <meta name="slurp" content="noindex, nofollow">
    <meta name="duckduckbot" content="noindex, nofollow">
    <title>Interactive Map</title>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet.polylinemeasure/Leaflet.PolylineMeasure.css" />
</head>
<body>
    <div id="map"></div>
    <div id="measure-control" class="map-control-button">
        <button id="measure-distance-btn" class="map-control-btn">Измерить расстояние</button>
    </div>
    <div id="route-control" class="map-control-button" style="top: 60px;">
        <button id="build-route-btn" class="map-control-btn">Построить маршрут</button>
        <div id="route-submenu" class="points-submenu" style="display: none;">
            <button id="cancel-route-btn" class="points-submenu-btn">Отменить маршрут</button>
            <button id="import-route-btn" class="points-submenu-btn">Загрузить маршрут</button>
            <button id="calculate-route-btn" class="points-submenu-btn" style="display: none;">Рассчитать маршрут</button>
        </div>
    </div>
    <div id="points-control" class="map-control-button" style="top: 110px;">
        <button id="add-point-btn" class="map-control-btn">Добавить точки</button>
        <div id="points-submenu" class="points-submenu" style="display: none;">
            <button id="place-point-btn" class="points-submenu-btn">Показать точку на карте</button>
            <button id="enter-coords-btn" class="points-submenu-btn">Ввести координаты точки</button>
            <button id="import-points-btn" class="points-submenu-btn">Загрузить точки</button>
        </div>
        <div id="coords-input-submenu" class="points-submenu" style="display: none;">
            <input type="number" id="lat-input" class="coords-input" placeholder="Широта" step="any">
            <input type="number" id="lng-input" class="coords-input" placeholder="Долгота" step="any">
            <button id="cancel-coords-btn" class="points-submenu-btn">Отмена</button>
            <button id="enter-coords-submit-btn" class="points-submenu-btn">Ввести</button>
        </div>
        <button id="finish-placing-btn" class="map-control-btn" style="display: none;">Закончить установку точек</button>
        <button id="reset-points-btn" class="map-control-btn" style="display: none;">Сбросить точки</button>
        <button id="export-points-btn" class="map-control-btn" style="display: none;">Выгрузить точки</button>
    </div>
    <input type="file" id="csv-importer" accept="route*.csv,.csv" style="display: none;" multiple="false">
    <input type="file" id="points-csv-importer" accept=".csv" style="display: none;">
    <div id="hamburger-menu" class="menu-button">
        <span></span>
        <span></span>
        <span></span>
    </div>
    <div id="side-menu">
        <div id="side-menu-header">
            <div id="route-color-buttons-container"></div>
            <button id="logout-btn" class="logout-button" title="Выйти из системы">Выход</button>
            <div id="close-menu-btn">&times;</div>
        </div>
        
        <!-- Основная карта -->
        <div class="menu-section">
            <div class="menu-section-title">Основная карта</div>
            <div class="menu-item">
                <label for="brightness-slider">Яркость основной карты</label>
                <input type="range" id="brightness-slider" min="0" max="100" value="100">
            </div>
             <div class="menu-item radio-option">
                <input type="radio" id="base-jawgdark" name="base-map-type" value="jawgdark" checked>
                <label for="base-jawgdark">Dark</label>
            </div>
            <div class="menu-item radio-option">
                <input type="radio" id="base-gray" name="base-map-type" value="gray">
                <label for="base-gray">Серая карта</label>
            </div>
            <div class="menu-item radio-option">
                <input type="radio" id="base-opentopomap" name="base-map-type" value="opentopomap">
                <label for="base-opentopomap">OpenTopoMap (с высотами)</label>
            </div>
            <div class="menu-item radio-option">
                <input type="radio" id="base-thunderforestlandscape" name="base-map-type" value="thunderforestlandscape">
                <label for="base-thunderforestlandscape">Карта рельефа с высотами</label>
            </div>
            <div class="menu-item radio-option">
                <input type="radio" id="base-cyclosm" name="base-map-type" value="cyclosm">
                <label for="base-cyclosm">Тропинки, дорожки, высоты</label>
            </div>
            <div class="menu-item radio-option">
                <input type="radio" id="base-super-contrast-relief" name="base-map-type" value="super-contrast-relief">
                <label for="base-super-contrast-relief">Супер-контрастный рельеф</label>
            </div>
            <div class="menu-item radio-option">
                <input type="radio" id="base-contrast-relief" name="base-map-type" value="contrast-relief">
                <label for="base-contrast-relief">Контрастный рельеф</label>
            </div>
            <div class="menu-item radio-option">
                <input type="radio" id="base-monochrome" name="base-map-type" value="monochrome">
                <label for="base-monochrome">Монохромная карта рельефа</label>
            </div>
            <div class="menu-item radio-option">
                <input type="radio" id="base-esriworldimagery" name="base-map-type" value="esriworldimagery">
                <label for="base-esriworldimagery">Спутник</label>
            </div>
            <div class="menu-item radio-option">
                <input type="radio" id="base-openstreetmap" name="base-map-type" value="openstreetmap">
                <label for="base-openstreetmap">OpenStreetMap</label>
            </div>
            <div class="menu-item radio-option">
                <input type="radio" id="base-cartovoyager" name="base-map-type" value="cartovoyager">
                <label for="base-cartovoyager">Светлая карта-подложка</label>
            </div>
            <div class="menu-item radio-option">
                <input type="radio" id="base-esriocean" name="base-map-type" value="esriocean">
                <label for="base-esriocean">Карта рек и озер</label>
            </div>
            <div class="menu-item radio-option">
                <input type="radio" id="base-nasanight" name="base-map-type" value="nasanight">
                <label for="base-nasanight">Ночное время суток</label>
            </div>
            <div class="menu-item radio-option">
                <input type="radio" id="base-waze" name="base-map-type" value="waze">
                <label for="base-waze">Дороги</label>
            </div>
        </div>

        <!-- Верхняя карта -->
        <div class="menu-section">
            <div class="menu-section-title">Верхняя карта</div>
            <div class="menu-item checkbox-option">
                <input type="checkbox" id="enable-overlay-map">
                <label for="enable-overlay-map">Включить верхнюю карту</label>
            </div>
            <div id="overlay-map-controls" style="display: none;">
                <div class="menu-item">
                    <label for="overlay-opacity-slider">Прозрачность верхней карты</label>
                    <input type="range" id="overlay-opacity-slider" min="0" max="100" value="50">
                </div>
                <div class="menu-item radio-option">
                    <input type="radio" id="overlay-jawgdark" name="overlay-map-type" value="jawgdark">
                    <label for="overlay-jawgdark">Dark</label>
                </div>
                <div class="menu-item radio-option">
                    <input type="radio" id="overlay-gray" name="overlay-map-type" value="gray">
                    <label for="overlay-gray">Серая карта</label>
                </div>
                <div class="menu-item radio-option">
                    <input type="radio" id="overlay-opentopomap" name="overlay-map-type" value="opentopomap" checked>
                    <label for="overlay-opentopomap">OpenTopoMap (с высотами)</label>
                </div>
                <div class="menu-item radio-option">
                    <input type="radio" id="overlay-thunderforestlandscape" name="overlay-map-type" value="thunderforestlandscape">
                    <label for="overlay-thunderforestlandscape">Карта рельефа с высотами</label>
                </div>
                <div class="menu-item radio-option">
                    <input type="radio" id="overlay-cyclosm" name="overlay-map-type" value="cyclosm">
                    <label for="overlay-cyclosm">Тропинки, дорожки, высоты</label>
                </div>
                <div class="menu-item radio-option">
                    <input type="radio" id="overlay-super-contrast-relief" name="overlay-map-type" value="super-contrast-relief">
                    <label for="overlay-super-contrast-relief">Супер-контрастный рельеф</label>
                </div>
                <div class="menu-item radio-option">
                    <input type="radio" id="overlay-contrast-relief" name="overlay-map-type" value="contrast-relief">
                    <label for="overlay-contrast-relief">Контрастный рельеф</label>
                </div>
                <div class="menu-item radio-option">
                    <input type="radio" id="overlay-monochrome" name="overlay-map-type" value="monochrome">
                    <label for="overlay-monochrome">Монохромная карта рельефа</label>
                </div>
                <div class="menu-item radio-option">
                    <input type="radio" id="overlay-esriworldimagery" name="overlay-map-type" value="esriworldimagery">
                    <label for="overlay-esriworldimagery">Спутник</label>
                </div>
                <div class="menu-item radio-option">
                    <input type="radio" id="overlay-openstreetmap" name="overlay-map-type" value="openstreetmap">
                    <label for="overlay-openstreetmap">OpenStreetMap</label>
                </div>
                <div class="menu-item radio-option">
                    <input type="radio" id="overlay-cartovoyager" name="overlay-map-type" value="cartovoyager">
                    <label for="overlay-cartovoyager">Светлая карта-подложка</label>
                </div>
                <div class="menu-item radio-option">
                    <input type="radio" id="overlay-esriocean" name="overlay-map-type" value="esriocean">
                    <label for="overlay-esriocean">Карта рек и озер</label>
                </div>
                <div class="menu-item radio-option">
                    <input type="radio" id="overlay-nasanight" name="overlay-map-type" value="nasanight">
                    <label for="overlay-nasanight">Ночное время суток</label>
                </div>
                <div class="menu-item radio-option">
                    <input type="radio" id="overlay-waze" name="overlay-map-type" value="waze">
                    <label for="overlay-waze">Дороги</label>
                </div>
            </div>
        </div>

        <!-- Слои -->
        <div class="menu-section">
            <div class="menu-section-title">Слои</div>
            <div class="menu-item checkbox-option">
                <input type="checkbox" id="enable-roads-layer">
                <label for="enable-roads-layer">Железные дороги</label>
            </div>
            <div id="roads-layer-controls" style="display: none;">
                <div class="menu-item">
                    <label for="roads-opacity-slider">Прозрачность железных дорог</label>
                    <input type="range" id="roads-opacity-slider" min="0" max="100" value="100">
                </div>
            </div>
            <div class="menu-item checkbox-option">
                <input type="checkbox" id="enable-borders-layer">
                <label for="enable-borders-layer">Границы, дороги, улицы</label>
            </div>
            <div id="borders-layer-controls" style="display: none;">
                <div class="menu-item">
                    <label for="borders-opacity-slider">Прозрачность границ, дорог улиц</label>
                    <input type="range" id="borders-opacity-slider" min="0" max="100" value="100">
                </div>
            </div>
            <div class="menu-item checkbox-option">
                <input type="checkbox" id="enable-labels-layer">
                <label for="enable-labels-layer">Географические названия</label>
            </div>
            <div id="labels-layer-controls" style="display: none;">
                <div class="menu-item">
                    <label for="labels-opacity-slider">Прозрачность географических названий</label>
                    <input type="range" id="labels-opacity-slider" min="0" max="100" value="100">
                </div>
            </div>
        </div>

        <!-- Краткая инструкция -->
        <div class="menu-section">
            <div class="menu-item instruction-item">
                <label class="instruction-label" id="instruction-label">Информация о приложении</label>
            </div>
        </div>

    </div>
    
    <!-- Контейнер для графика профиля высоты -->
    <div id="elevation-profile">
        <div id="profile-header">
            <div id="profile-title-wrapper"></div>
            <div id="profile-close-btn">
                <span></span>
                <span></span>
            </div>
        </div>
        <div id="profile-buttons-container">
            <button id="step-25-btn" class="step-btn" data-step="25">Шаг 25м</button>
            <button id="step-50-btn" class="step-btn active" data-step="50">Шаг 50м</button>
            <button id="step-100-btn" class="step-btn" data-step="100">Шаг 100м</button>
            <button id="export-route-btn" class="profile-action-btn">Выгрузить</button>
        </div>
        <div id="profile-chart"></div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>
    <script src="https://unpkg.com/topojson-client@3.1.0/dist/topojson-client.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet.polylinemeasure@latest/Leaflet.PolylineMeasure.js"></script>
    <script src="script.js?v=5.4"></script>

    <div id="geo-error-modal" class="hidden">
        <p>Не удалось определить ваше местоположение. Включите геолокацию в настройках браузера.</p>
        <button id="geo-error-cancel">Ок</button>
        <div>
            <input type="checkbox" id="geo-error-dont-show">
            <label for="geo-error-dont-show">Больше не показывать</label>
        </div>
    </div>
    
    <!-- Попап для ввода названия и описания точки -->
    <div id="point-info-popup" class="point-info-popup" style="display: none;">
        <div class="point-info-content">
            <h3>Информация о точке</h3>
            <input type="text" id="point-name-input" class="point-info-input" placeholder="Название точки">
            <textarea id="point-description-input" class="point-info-input" placeholder="Описание точки" rows="3"></textarea>
            <input type="number" id="point-lat-input" class="point-info-input" placeholder="Широта" step="any">
            <input type="number" id="point-lng-input" class="point-info-input" placeholder="Долгота" step="any">
            <button id="save-point-btn" class="point-info-btn">Сохранить</button>
            <button id="cancel-point-btn" class="point-info-btn cancel-btn">Отмена</button>
        </div>
    </div>

    <!-- Модальное окно с инструкцией -->
    <div id="instruction-modal" class="instruction-modal" style="display: none;">
        <div class="instruction-modal-content">
            <div class="instruction-modal-close" id="instruction-close-btn">&times;</div>
            <div class="instruction-modal-text">
                <p>
                Цвет линии маршрута можно менять - для темных и для светлых карт (В боковом меню сверху).<br><br>
                Линии маршрутов визуально искривлены - это не ошибка, это учет кривизны Земли для более точного расчета. <br><br>
                Данные по высотам загружены в отдельную базу и имеются для всей территории УГИЛа и чуть восточнее, что исключает применение по нам, если программа попадет не в те руки. <br><br>
                Каждый час программа просит авторизоваться - мера предосторожности. <br><br>
                При выгрузке данных (маршрутов с профилем высоты или точек) - данные шифруются, что исключает возможность их перехвата. <br><br>
                Выгруженные данные сохраняются в файл .csv, который можно открыть в любом текстовом редакторе. <br><br>
                Файл маршрута представляет из себя таблицу с колонками: широта, долгота, высота, расстояние, признак ключевой точки (1 - точка, отмеченная при построении маршрута, 0 - нет точки - просто линия маршрута). <br><br>
                Дискретизация данных в файле зависит от выбранного шага при построении маршрута (25м, 50м, 100м). <br><br>

                Для обратной связи, предложений и замечаний: bwxzaklg@strekozoid.anonaddy.me
                </p>
            </div>
        </div>
    </div>
</body>
</html>