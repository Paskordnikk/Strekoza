<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Map</title>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet.polylinemeasure/Leaflet.PolylineMeasure.css" />
</head>
<body>
    <div id="map"></div>
    <div id="measure-control" class="map-control-button">
        <button id="measure-distance-btn" class="map-control-btn">Измерить расстояние</button>
    </div>
    <div id="route-control" class="map-control-button" style="top: 60px;">
        <button id="build-route-btn" class="map-control-btn">Построить маршрут</button>
    </div>
    <div id="import-control" class="map-control-button" style="top: 110px;">
        <button id="import-route-btn" class="map-control-btn">Загрузить маршрут</button>
    </div>
    <input type="file" id="csv-importer" accept=".csv" style="display: none;">
    <div id="route-calc-control" class="map-control-button" style="display: none; top: 60px;">
        <button id="calculate-route-btn" class="map-control-btn">Рассчитать маршрут</button>
    </div>
    <div id="hamburger-menu" class="menu-button">
        <span></span>
        <span></span>
        <span></span>
    </div>
    <div id="side-menu">
        <div id="close-menu-btn">&times;</div>
        
        <!-- Основная карта -->
        <div class="menu-section">
            <div class="menu-section-title">Основная карта</div>
            <div class="menu-item">
                <label for="brightness-slider">Яркость основной карты</label>
                <input type="range" id="brightness-slider" min="0" max="100" value="100">
            </div>
            <div class="menu-item radio-option">
                <input type="radio" id="base-opentopomap" name="base-map-type" value="opentopomap" checked>
                <label for="base-opentopomap">OpenTopoMap (с высотами)</label>
            </div>
            <div class="menu-item radio-option">
                <input type="radio" id="base-thunderforestlandscape" name="base-map-type" value="thunderforestlandscape">
                <label for="base-thunderforestlandscape">Карта рельефа с высотами</label>
            </div>
            <div class="menu-item radio-option">
                <input type="radio" id="base-cyclosm" name="base-map-type" value="cyclosm">
                <label for="base-cyclosm">Тропинки, дорожки, высоты</label>
            </div>
            <div class="menu-item radio-option">
                <input type="radio" id="base-monochrome" name="base-map-type" value="monochrome">
                <label for="base-monochrome">Монохромная карта рельефа</label>
            </div>
            <div class="menu-item radio-option">
                <input type="radio" id="base-esriworldimagery" name="base-map-type" value="esriworldimagery">
                <label for="base-esriworldimagery">Спутник</label>
            </div>
            <div class="menu-item radio-option">
                <input type="radio" id="base-openstreetmap" name="base-map-type" value="openstreetmap">
                <label for="base-openstreetmap">OpenStreetMap</label>
            </div>
            <div class="menu-item radio-option">
                <input type="radio" id="base-cartovoyager" name="base-map-type" value="cartovoyager">
                <label for="base-cartovoyager">Светлая карта-подложка</label>
            </div>
            <div class="menu-item radio-option">
                <input type="radio" id="base-esriocean" name="base-map-type" value="esriocean">
                <label for="base-esriocean">Карта рек и озер</label>
            </div>
            <div class="menu-item radio-option">
                <input type="radio" id="base-nasanight" name="base-map-type" value="nasanight">
                <label for="base-nasanight">Ночное время суток</label>
            </div>
            <div class="menu-item radio-option">
                <input type="radio" id="base-jawgdark" name="base-map-type" value="jawgdark">
                <label for="base-jawgdark">Dark</label>
            </div>
        </div>

        <!-- Верхняя карта -->
        <div class="menu-section">
            <div class="menu-section-title">Верхняя карта</div>
            <div class="menu-item checkbox-option">
                <input type="checkbox" id="enable-overlay-map">
                <label for="enable-overlay-map">Включить верхнюю карту</label>
            </div>
            <div id="overlay-map-controls" style="display: none;">
                <div class="menu-item">
                    <label for="overlay-opacity-slider">Прозрачность верхней карты</label>
                    <input type="range" id="overlay-opacity-slider" min="0" max="100" value="50">
                </div>
                <div class="menu-item radio-option">
                    <input type="radio" id="overlay-opentopomap" name="overlay-map-type" value="opentopomap" checked>
                    <label for="overlay-opentopomap">OpenTopoMap (с высотами)</label>
                </div>
                <div class="menu-item radio-option">
                    <input type="radio" id="overlay-thunderforestlandscape" name="overlay-map-type" value="thunderforestlandscape">
                    <label for="overlay-thunderforestlandscape">Карта рельефа с высотами</label>
                </div>
                <div class="menu-item radio-option">
                    <input type="radio" id="overlay-cyclosm" name="overlay-map-type" value="cyclosm">
                    <label for="overlay-cyclosm">Тропинки, дорожки, высоты</label>
                </div>
                <div class="menu-item radio-option">
                    <input type="radio" id="overlay-monochrome" name="overlay-map-type" value="monochrome">
                    <label for="overlay-monochrome">Монохромная карта рельефа</label>
                </div>
                <div class="menu-item radio-option">
                    <input type="radio" id="overlay-esriworldimagery" name="overlay-map-type" value="esriworldimagery">
                    <label for="overlay-esriworldimagery">Спутник</label>
                </div>
                <div class="menu-item radio-option">
                    <input type="radio" id="overlay-openstreetmap" name="overlay-map-type" value="openstreetmap">
                    <label for="overlay-openstreetmap">OpenStreetMap</label>
                </div>
                <div class="menu-item radio-option">
                    <input type="radio" id="overlay-cartovoyager" name="overlay-map-type" value="cartovoyager">
                    <label for="overlay-cartovoyager">Светлая карта-подложка</label>
                </div>
                <div class="menu-item radio-option">
                    <input type="radio" id="overlay-esriocean" name="overlay-map-type" value="esriocean">
                    <label for="overlay-esriocean">Карта рек и озер</label>
                </div>
                <div class="menu-item radio-option">
                    <input type="radio" id="overlay-nasanight" name="overlay-map-type" value="nasanight">
                    <label for="overlay-nasanight">Ночное время суток</label>
                </div>
                <div class="menu-item radio-option">
                    <input type="radio" id="overlay-jawgdark" name="overlay-map-type" value="jawgdark">
                    <label for="overlay-jawgdark">Dark</label>
                </div>
            </div>
        </div>

        <!-- Слои -->
        <div class="menu-section">
            <div class="menu-section-title">Слои</div>
            <div class="menu-item checkbox-option">
                <input type="checkbox" id="enable-roads-layer">
                <label for="enable-roads-layer">Железные дороги</label>
            </div>
            <div id="roads-layer-controls" style="display: none;">
                <div class="menu-item">
                    <label for="roads-opacity-slider">Прозрачность слоя дорог</label>
                    <input type="range" id="roads-opacity-slider" min="0" max="100" value="100">
                </div>
            </div>
            <div class="menu-item checkbox-option">
                <input type="checkbox" id="enable-borders-layer">
                <label for="enable-borders-layer">Границы</label>
            </div>
            <div id="borders-layer-controls" style="display: none;">
                <div class="menu-item">
                    <label for="borders-opacity-slider">Прозрачность слоя границ</label>
                    <input type="range" id="borders-opacity-slider" min="0" max="100" value="100">
                </div>
            </div>
            <div class="menu-item checkbox-option">
                <input type="checkbox" id="enable-labels-layer">
                <label for="enable-labels-layer">Географические названия</label>
            </div>
            <div id="labels-layer-controls" style="display: none;">
                <div class="menu-item">
                    <label for="labels-opacity-slider">Прозрачность слоя названий</label>
                    <input type="range" id="labels-opacity-slider" min="0" max="100" value="100">
                </div>
            </div>
        </div>

    </div>
    
    <!-- Контейнер для графика профиля высоты -->
    <div id="elevation-profile">
        <div id="profile-header">
            <div id="profile-title-wrapper"></div>
            <div id="profile-close-btn">
                <span></span>
                <span></span>
            </div>
        </div>
        <div id="profile-buttons-container">
            <button id="step-25-btn" class="step-btn" data-step="25">Шаг 25м</button>
            <button id="step-50-btn" class="step-btn active" data-step="50">Шаг 50м</button>
            <button id="step-100-btn" class="step-btn" data-step="100">Шаг 100м</button>
            <button id="export-route-btn" class="profile-action-btn">Выгрузить</button>
        </div>
        <div id="profile-chart"></div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/topojson-client@3.1.0/dist/topojson-client.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet.polylinemeasure@latest/Leaflet.PolylineMeasure.js"></script>
    <script src="script.js?v=5.0"></script>

    <script>
        // Автоматически загружаем консоль разработчика на мобильных устройствах
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        if (isMobile) {
            const script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/eruda';
            script.onload = function() {
                eruda.init();
            };
            document.body.appendChild(script);
        }
    </script>

    <div id="geo-error-modal" class="hidden">
        <p>Не удалось определить ваше местоположение. Включите геолокацию в настройках браузера.</p>
        <button id="geo-error-cancel">Ок</button>
        <div>
            <input type="checkbox" id="geo-error-dont-show">
            <label for="geo-error-dont-show">Больше не показывать</label>
        </div>
    </div>
</body>
</html>