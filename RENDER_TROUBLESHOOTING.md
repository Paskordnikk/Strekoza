# Troubleshooting: Проблемы с аутентификацией на Render.com

## Проблема: 404 при обращении к /api/login

### Проверка 1: Start Command

На Render.com в настройках сервиса проверьте **Start Command**:

**Правильный Start Command:**
```bash
gunicorn -w 4 -k uvicorn.workers.UvicornWorker server:app
```

**Неправильные варианты:**
- ❌ `python server.py` - не работает с gunicorn
- ❌ `uvicorn server:app --host 0.0.0.0 --port $PORT` - может работать, но gunicorn лучше

### Проверка 2: Переменные окружения

Убедитесь, что в разделе **Environment** установлены:

1. **`SITE_PASSWORD`** - ваш пароль для доступа
2. **`JWT_SECRET_KEY`** - длинный случайный ключ
3. **`PORT`** - автоматически устанавливается Render.com (не нужно настраивать вручную)

### Проверка 3: Логи при старте

После перезапуска сервера в логах должно быть видно:

```
[INFO] Пароль установлен: переменная окружения (SITE_PASSWORD), длина пароля: X символов
```

Если этого сообщения нет - переменная `SITE_PASSWORD` не установлена или не читается.

### Проверка 4: Логи при попытке входа

Когда вы пытаетесь войти, в логах должно появиться:

```
[DEBUG] Login attempt: received password length=X, expected length=Y
[DEBUG] Current password from env: True
[DEBUG] Password match: False/True
```

Если `Password match: False` - пароли не совпадают.

## Проблема: Пароль не проходит

### Диагностика:

1. **Проверьте логи при попытке входа:**
   - Смотрите логи на Render.com в реальном времени
   - Попробуйте войти и смотрите, что появляется в логах

2. **Проверьте переменную окружения:**
   - Убедитесь, что в настройках Render.com переменная `SITE_PASSWORD` установлена
   - Проверьте, что нет лишних пробелов или кавычек в значении

3. **Проверьте URL API:**
   - В `login.js` должен быть правильный URL вашего сервиса на Render.com
   - Например: `https://your-service-name.onrender.com`

4. **Проверьте CORS:**
   - В `server.py` CORS должен разрешать запросы с вашего домена GitHub Pages
   - Убедитесь, что `allow_origins=["*"]` или добавлен ваш домен

## Проблема: Переменные окружения не работают

### Решение:

1. Удалите переменные и создайте заново
2. Убедитесь, что нет пробелов в именах переменных
3. Перезапустите сервис после изменения переменных

## Проблема: Сервер не запускается

### Проверьте:

1. **Логи ошибок** - смотрите, что именно не работает
2. **requirements.txt** - все зависимости должны быть указаны
3. **Start Command** - должен быть правильным (см. выше)

## Быстрая диагностика

### Шаг 1: Проверьте логи при старте
```
[INFO] Пароль установлен: переменная окружения (SITE_PASSWORD), длина пароля: X символов
```
✅ Если видно - переменные работают  
❌ Если не видно или "по умолчанию" - переменные не установлены

### Шаг 2: Попробуйте войти и смотрите логи
```
[DEBUG] Login attempt: received password length=X, expected length=Y
[DEBUG] Password match: False
```
✅ Если `Password match: False` - пароли не совпадают  
✅ Если `Password match: True` - пароли совпадают, но может быть другая проблема

### Шаг 3: Проверьте URL в браузере
Откройте в браузере: `https://your-service.onrender.com/docs`
✅ Если открывается Swagger UI - сервер работает  
❌ Если 404 или ошибка - проблема с запуском сервера

### Шаг 4: Проверьте эндпоинт напрямую
Откройте: `https://your-service.onrender.com/api/login`
✅ Если видите JSON с ошибкой - эндпоинт работает  
❌ Если 404 - проблема с маршрутизацией

## Контрольный список

- [ ] Start Command: `gunicorn -w 4 -k uvicorn.workers.UvicornWorker server:app`
- [ ] Переменная `SITE_PASSWORD` установлена
- [ ] Переменная `JWT_SECRET_KEY` установлена
- [ ] Сервис перезапущен после изменения переменных
- [ ] В логах видно `[INFO] Пароль установлен: переменная окружения`
- [ ] URL в `login.js` правильный (ваш сервис на Render.com)
- [ ] CORS настроен правильно в `server.py`

